{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jiang\\\\Documents\\\\GitHub\\\\DesignInAction-WebsiteTest-5\\\\src\\\\components\\\\DesignStudio.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls';\nimport { useStore } from '../store';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DesignStudio = () => {\n  _s();\n  const containerRef = useRef(null);\n  const sceneRef = useRef(null);\n  const cameraRef = useRef(null);\n  const rendererRef = useRef(null);\n  const controlsRef = useRef(null);\n  const transformControlsRef = useRef(null);\n  const meshesRef = useRef([]);\n  const selectedObjectRef = useRef(null);\n  const {\n    buildingData,\n    updateBuildingData\n  } = useStore();\n\n  // 更新模型函数\n  const updateModel = data => {\n    if (!sceneRef.current) return;\n    const scene = sceneRef.current;\n\n    // 清除现有网格\n    meshesRef.current.forEach(mesh => scene.remove(mesh));\n    meshesRef.current = [];\n\n    // 加载模型\n    data.objects.forEach((obj, index) => {\n      if (obj.geometry.vertices) {\n        // 计算几何体的边界框\n        const boundingBox = {\n          min: new THREE.Vector3(Infinity, Infinity, Infinity),\n          max: new THREE.Vector3(-Infinity, -Infinity, -Infinity)\n        };\n\n        // 找出边界框\n        obj.geometry.vertices.forEach(vertex => {\n          boundingBox.min.x = Math.min(boundingBox.min.x, vertex[0]);\n          boundingBox.min.y = Math.min(boundingBox.min.y, vertex[2]);\n          boundingBox.min.z = Math.min(boundingBox.min.z, vertex[1]);\n          boundingBox.max.x = Math.max(boundingBox.max.x, vertex[0]);\n          boundingBox.max.y = Math.max(boundingBox.max.y, vertex[2]);\n          boundingBox.max.z = Math.max(boundingBox.max.z, vertex[1]);\n        });\n\n        // 计算中心点\n        const center = new THREE.Vector3((boundingBox.min.x + boundingBox.max.x) / 2, (boundingBox.min.y + boundingBox.max.y) / 2, (boundingBox.min.z + boundingBox.max.z) / 2);\n\n        // 创建顶点\n        const vertexArray = new Float32Array(obj.geometry.vertices.flatMap(vertex => [vertex[0] - center.x, vertex[2] - center.y, vertex[1] - center.z]));\n        const geometry = new THREE.BufferGeometry();\n        geometry.setAttribute('position', new THREE.BufferAttribute(vertexArray, 3));\n\n        // 创建面索引\n        const indices = [];\n        obj.geometry.faces.forEach(face => {\n          if (face.length === 4) {\n            indices.push(face[0], face[1], face[2]);\n            indices.push(face[2], face[3], face[0]);\n          } else {\n            indices.push(...face);\n          }\n        });\n        geometry.setIndex(new THREE.BufferAttribute(new Uint16Array(indices), 1));\n        geometry.computeVertexNormals();\n\n        // 创建材质\n        const material = new THREE.MeshPhongMaterial({\n          transparent: obj.material.transparency > 0,\n          opacity: 1 - obj.material.transparency,\n          side: THREE.DoubleSide,\n          roughness: obj.material.roughness || 0.5\n        });\n\n        // 加载纹理或设置颜色\n        if (obj.material.texture) {\n          const textureLoader = new THREE.TextureLoader();\n          textureLoader.load(obj.material.texture, texture => {\n            material.map = texture;\n            material.needsUpdate = true;\n          });\n        } else {\n          material.color = new THREE.Color(obj.material.color[0] / 255, obj.material.color[1] / 255, obj.material.color[2] / 255);\n        }\n        const mesh = new THREE.Mesh(geometry, material);\n        mesh.position.copy(center);\n        mesh.userData.id = obj.id;\n        mesh.userData.layer = obj.layer;\n        mesh.castShadow = true;\n        mesh.receiveShadow = true;\n        scene.add(mesh);\n        meshesRef.current.push(mesh);\n      }\n    });\n  };\n\n  // 加载和更新模型\n  useEffect(() => {\n    if (!sceneRef.current || !buildingData) return;\n    const scene = sceneRef.current;\n\n    // 清除现有对象\n    scene.children = scene.children.filter(child => child.type === 'GridHelper' || child.type === 'TransformControls' || child.type === 'DirectionalLight' || child.type === 'AmbientLight');\n\n    // 创建材质\n    const materials = {\n      wall: new THREE.MeshStandardMaterial({\n        color: 0xcccccc,\n        side: THREE.DoubleSide\n      }),\n      floor: new THREE.MeshStandardMaterial({\n        color: 0xeeeeee,\n        side: THREE.DoubleSide\n      }),\n      ceiling: new THREE.MeshStandardMaterial({\n        color: 0xdddddd,\n        side: THREE.DoubleSide\n      })\n    };\n\n    // 创建房间布局\n    const createRoom = (position, size, type) => {\n      const {\n        width,\n        depth,\n        height\n      } = size;\n      const {\n        x,\n        y,\n        z\n      } = position;\n\n      // 创建地板\n      const floorGeometry = new THREE.BoxGeometry(width, 1, depth);\n      const floor = new THREE.Mesh(floorGeometry, materials.floor);\n      floor.position.set(x, y, z);\n      floor.receiveShadow = true;\n      scene.add(floor);\n\n      // 创建天花板\n      const ceilingGeometry = new THREE.BoxGeometry(width, 1, depth);\n      const ceiling = new THREE.Mesh(ceilingGeometry, materials.ceiling);\n      ceiling.position.set(x, y + height, z);\n      ceiling.castShadow = true;\n      scene.add(ceiling);\n\n      // 创建墙体\n      const wallThickness = 20;\n      const wallHeight = height;\n\n      // 前墙\n      const frontWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);\n      const frontWall = new THREE.Mesh(frontWallGeometry, materials.wall);\n      frontWall.position.set(x, y + wallHeight / 2, z + depth / 2);\n      frontWall.castShadow = true;\n      frontWall.receiveShadow = true;\n      scene.add(frontWall);\n\n      // 后墙\n      const backWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);\n      const backWall = new THREE.Mesh(backWallGeometry, materials.wall);\n      backWall.position.set(x, y + wallHeight / 2, z - depth / 2);\n      backWall.castShadow = true;\n      backWall.receiveShadow = true;\n      scene.add(backWall);\n\n      // 左墙\n      const leftWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);\n      const leftWall = new THREE.Mesh(leftWallGeometry, materials.wall);\n      leftWall.position.set(x - width / 2, y + wallHeight / 2, z);\n      leftWall.castShadow = true;\n      leftWall.receiveShadow = true;\n      scene.add(leftWall);\n\n      // 右墙\n      const rightWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);\n      const rightWall = new THREE.Mesh(rightWallGeometry, materials.wall);\n      rightWall.position.set(x + width / 2, y + wallHeight / 2, z);\n      rightWall.castShadow = true;\n      rightWall.receiveShadow = true;\n      scene.add(rightWall);\n\n      // 为每个墙体添加用户数据\n      [floor, ceiling, frontWall, backWall, leftWall, rightWall].forEach(wall => {\n        wall.userData = {\n          id: `${type}-${Math.random().toString(36).substr(2, 9)}`,\n          type: type,\n          layer: 1\n        };\n      });\n    };\n\n    // 根据buildingData创建房间\n    const standardRoomHeight = 3000; // 标准房间高度\n    const standardRoomWidth = 6000; // 标准房间宽度\n    const standardRoomDepth = 4000; // 标准房间深度\n    const corridorWidth = 1500; // 走廊宽度\n    const wallThickness = 150; // 墙体厚度\n\n    // 创建客厅\n    createRoom({\n      x: 0,\n      y: 0,\n      z: 0\n    }, {\n      width: standardRoomWidth * 2,\n      depth: standardRoomDepth * 2,\n      height: standardRoomHeight\n    }, 'living-room');\n\n    // 根据卧室数量创建卧室\n    const bedroomCount = buildingData.properties.bedrooms;\n    if (bedroomCount > 0) {\n      // 计算卧室布局\n      const bedroomsPerRow = Math.ceil(bedroomCount / 2);\n      const totalWidth = standardRoomWidth * bedroomsPerRow + corridorWidth * (bedroomsPerRow - 1) + wallThickness * bedroomsPerRow;\n\n      // 创建卧室\n      for (let i = 0; i < bedroomCount; i++) {\n        const row = Math.floor(i / 2);\n        const col = i % 2;\n        const x = (col === 0 ? -totalWidth / 2 : totalWidth / 2) + (col === 0 ? standardRoomWidth / 2 : -standardRoomWidth / 2);\n        const z = row * (standardRoomDepth + corridorWidth + wallThickness) - standardRoomDepth * (bedroomsPerRow - 1) / 2;\n        createRoom({\n          x,\n          y: 0,\n          z\n        }, {\n          width: standardRoomWidth,\n          depth: standardRoomDepth,\n          height: standardRoomHeight\n        }, 'bedroom');\n      }\n    }\n  }, [buildingData]);\n\n  // 监听 buildingData 变化\n  useEffect(() => {\n    if (buildingData) {\n      updateModel(buildingData);\n    }\n  }, [buildingData]);\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    // 初始化场景\n    const scene = new THREE.Scene();\n    scene.background = new THREE.Color(0xf0f0f0);\n    sceneRef.current = scene;\n\n    // 初始化相机\n    const camera = new THREE.PerspectiveCamera(75, window.innerWidth * 0.8 / window.innerHeight, 0.1, 50000);\n    camera.position.set(15000, 15000, 15000);\n    camera.lookAt(0, 0, 0);\n    cameraRef.current = camera;\n\n    // 初始化渲染器\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(window.innerWidth * 0.8, window.innerHeight);\n    renderer.shadowMap.enabled = true;\n    containerRef.current.appendChild(renderer.domElement);\n    rendererRef.current = renderer;\n\n    // 添加光源\n    const ambientLight = new THREE.AmbientLight(0x404040, 2);\n    scene.add(ambientLight);\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 2);\n    directionalLight.position.set(10000, 20000, 10000);\n    scene.add(directionalLight);\n\n    // 添加网格\n    const gridHelper = new THREE.GridHelper(30000, 30);\n    scene.add(gridHelper);\n\n    // 初始化控制器\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.mouseButtons = {\n      LEFT: null,\n      MIDDLE: null,\n      RIGHT: THREE.MOUSE.ROTATE\n    };\n    controls.enablePan = true;\n    controls.enableZoom = true;\n    controls.panButton = THREE.MOUSE.MIDDLE;\n    controlsRef.current = controls;\n\n    // 初始化变换控制器\n    const transformControls = new TransformControls(camera, renderer.domElement);\n    transformControls.setSize(1);\n    transformControls.setTranslationSnap(100);\n    transformControls.setRotationSnap(THREE.MathUtils.degToRad(15));\n    transformControls.setScaleSnap(0.1);\n    scene.add(transformControls);\n    transformControlsRef.current = transformControls;\n\n    // 加载初始模型\n    fetch('/building.json').then(response => response.json()).then(jsonModel => {\n      updateBuildingData(jsonModel);\n    }).catch(error => console.error('Error loading model:', error));\n\n    // 动画循环\n    const animate = () => {\n      requestAnimationFrame(animate);\n      controls.update();\n      renderer.render(scene, camera);\n    };\n    animate();\n\n    // 窗口大小调整\n    const handleResize = () => {\n      if (!camera || !renderer) return;\n      camera.aspect = window.innerWidth * 0.8 / window.innerHeight;\n      camera.updateProjectionMatrix();\n      renderer.setSize(window.innerWidth * 0.8, window.innerHeight);\n    };\n    window.addEventListener('resize', handleResize);\n\n    // 清理函数\n    const container = containerRef.current;\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      if (container) {\n        container.removeChild(renderer.domElement);\n      }\n      renderer.dispose();\n    };\n  }, [updateBuildingData]);\n\n  // 添加键盘快捷键支持\n  useEffect(() => {\n    const handleKeyDown = event => {\n      if (!selectedObjectRef.current || !transformControlsRef.current) return;\n      switch (event.key.toLowerCase()) {\n        case 'g':\n          transformControlsRef.current.setMode('translate');\n          break;\n        case 'r':\n          transformControlsRef.current.setMode('rotate');\n          break;\n        case 's':\n          transformControlsRef.current.setMode('scale');\n          break;\n        case 'escape':\n          if (selectedObjectRef.current) {\n            selectedObjectRef.current.material.emissive.setHex(0x000000);\n            selectedObjectRef.current = null;\n            transformControlsRef.current.detach();\n          }\n          break;\n        default:\n          break;\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    className: \"w-full h-full\",\n    onMouseDown: e => {\n      if (e.button === 0) {\n        // 左键点击\n        const raycaster = new THREE.Raycaster();\n        const mouse = new THREE.Vector2();\n        const rect = rendererRef.current.domElement.getBoundingClientRect();\n        mouse.x = (e.clientX - rect.left) / rect.width * 2 - 1;\n        mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;\n        raycaster.setFromCamera(mouse, cameraRef.current);\n        const intersects = raycaster.intersectObjects(meshesRef.current);\n        if (intersects.length > 0) {\n          const object = intersects[0].object;\n          if (selectedObjectRef.current !== object) {\n            if (selectedObjectRef.current) {\n              selectedObjectRef.current.material.emissive.setHex(0x000000);\n            }\n            selectedObjectRef.current = object;\n            object.material.emissive.setHex(0x333333);\n            transformControlsRef.current.attach(object);\n          }\n        } else {\n          if (selectedObjectRef.current) {\n            selectedObjectRef.current.material.emissive.setHex(0x000000);\n            selectedObjectRef.current = null;\n            transformControlsRef.current.detach();\n          }\n        }\n      }\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 386,\n    columnNumber: 5\n  }, this);\n};\n_s(DesignStudio, \"M1AJavCTjRgKD11qbW8T1hhlgz0=\", false, function () {\n  return [useStore];\n});\n_c = DesignStudio;\nexport default DesignStudio;\nvar _c;\n$RefreshReg$(_c, \"DesignStudio\");","map":{"version":3,"names":["React","useEffect","useRef","THREE","OrbitControls","TransformControls","useStore","jsxDEV","_jsxDEV","DesignStudio","_s","containerRef","sceneRef","cameraRef","rendererRef","controlsRef","transformControlsRef","meshesRef","selectedObjectRef","buildingData","updateBuildingData","updateModel","data","current","scene","forEach","mesh","remove","objects","obj","index","geometry","vertices","boundingBox","min","Vector3","Infinity","max","vertex","x","Math","y","z","center","vertexArray","Float32Array","flatMap","BufferGeometry","setAttribute","BufferAttribute","indices","faces","face","length","push","setIndex","Uint16Array","computeVertexNormals","material","MeshPhongMaterial","transparent","transparency","opacity","side","DoubleSide","roughness","texture","textureLoader","TextureLoader","load","map","needsUpdate","color","Color","Mesh","position","copy","userData","id","layer","castShadow","receiveShadow","add","children","filter","child","type","materials","wall","MeshStandardMaterial","floor","ceiling","createRoom","size","width","depth","height","floorGeometry","BoxGeometry","set","ceilingGeometry","wallThickness","wallHeight","frontWallGeometry","frontWall","backWallGeometry","backWall","leftWallGeometry","leftWall","rightWallGeometry","rightWall","random","toString","substr","standardRoomHeight","standardRoomWidth","standardRoomDepth","corridorWidth","bedroomCount","properties","bedrooms","bedroomsPerRow","ceil","totalWidth","i","row","col","Scene","background","camera","PerspectiveCamera","window","innerWidth","innerHeight","lookAt","renderer","WebGLRenderer","antialias","setSize","shadowMap","enabled","appendChild","domElement","ambientLight","AmbientLight","directionalLight","DirectionalLight","gridHelper","GridHelper","controls","mouseButtons","LEFT","MIDDLE","RIGHT","MOUSE","ROTATE","enablePan","enableZoom","panButton","transformControls","setTranslationSnap","setRotationSnap","MathUtils","degToRad","setScaleSnap","fetch","then","response","json","jsonModel","catch","error","console","animate","requestAnimationFrame","update","render","handleResize","aspect","updateProjectionMatrix","addEventListener","container","removeEventListener","removeChild","dispose","handleKeyDown","event","key","toLowerCase","setMode","emissive","setHex","detach","ref","className","onMouseDown","e","button","raycaster","Raycaster","mouse","Vector2","rect","getBoundingClientRect","clientX","left","clientY","top","setFromCamera","intersects","intersectObjects","object","attach","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/jiang/Documents/GitHub/DesignInAction-WebsiteTest-5/src/components/DesignStudio.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls';\r\nimport { useStore } from '../store';\r\n\r\nconst DesignStudio = () => {\r\n  const containerRef = useRef(null);\r\n  const sceneRef = useRef(null);\r\n  const cameraRef = useRef(null);\r\n  const rendererRef = useRef(null);\r\n  const controlsRef = useRef(null);\r\n  const transformControlsRef = useRef(null);\r\n  const meshesRef = useRef([]);\r\n  const selectedObjectRef = useRef(null);\r\n  const { buildingData, updateBuildingData } = useStore();\r\n\r\n  // 更新模型函数\r\n  const updateModel = (data) => {\r\n    if (!sceneRef.current) return;\r\n\r\n    const scene = sceneRef.current;\r\n    \r\n    // 清除现有网格\r\n    meshesRef.current.forEach(mesh => scene.remove(mesh));\r\n    meshesRef.current = [];\r\n\r\n    // 加载模型\r\n    data.objects.forEach((obj, index) => {\r\n      if (obj.geometry.vertices) {\r\n        // 计算几何体的边界框\r\n        const boundingBox = {\r\n          min: new THREE.Vector3(Infinity, Infinity, Infinity),\r\n          max: new THREE.Vector3(-Infinity, -Infinity, -Infinity)\r\n        };\r\n        \r\n        // 找出边界框\r\n        obj.geometry.vertices.forEach(vertex => {\r\n          boundingBox.min.x = Math.min(boundingBox.min.x, vertex[0]);\r\n          boundingBox.min.y = Math.min(boundingBox.min.y, vertex[2]);\r\n          boundingBox.min.z = Math.min(boundingBox.min.z, vertex[1]);\r\n          boundingBox.max.x = Math.max(boundingBox.max.x, vertex[0]);\r\n          boundingBox.max.y = Math.max(boundingBox.max.y, vertex[2]);\r\n          boundingBox.max.z = Math.max(boundingBox.max.z, vertex[1]);\r\n        });\r\n        \r\n        // 计算中心点\r\n        const center = new THREE.Vector3(\r\n          (boundingBox.min.x + boundingBox.max.x) / 2,\r\n          (boundingBox.min.y + boundingBox.max.y) / 2,\r\n          (boundingBox.min.z + boundingBox.max.z) / 2\r\n        );\r\n\r\n        // 创建顶点\r\n        const vertexArray = new Float32Array(\r\n          obj.geometry.vertices.flatMap(vertex => [\r\n            vertex[0] - center.x,\r\n            vertex[2] - center.y,\r\n            vertex[1] - center.z\r\n          ])\r\n        );\r\n\r\n        const geometry = new THREE.BufferGeometry();\r\n        geometry.setAttribute('position', new THREE.BufferAttribute(vertexArray, 3));\r\n\r\n        // 创建面索引\r\n        const indices = [];\r\n        obj.geometry.faces.forEach(face => {\r\n          if (face.length === 4) {\r\n            indices.push(face[0], face[1], face[2]);\r\n            indices.push(face[2], face[3], face[0]);\r\n          } else {\r\n            indices.push(...face);\r\n          }\r\n        });\r\n\r\n        geometry.setIndex(new THREE.BufferAttribute(new Uint16Array(indices), 1));\r\n        geometry.computeVertexNormals();\r\n\r\n        // 创建材质\r\n        const material = new THREE.MeshPhongMaterial({\r\n          transparent: obj.material.transparency > 0,\r\n          opacity: 1 - obj.material.transparency,\r\n          side: THREE.DoubleSide,\r\n          roughness: obj.material.roughness || 0.5\r\n        });\r\n\r\n        // 加载纹理或设置颜色\r\n        if (obj.material.texture) {\r\n          const textureLoader = new THREE.TextureLoader();\r\n          textureLoader.load(obj.material.texture, (texture) => {\r\n            material.map = texture;\r\n            material.needsUpdate = true;\r\n          });\r\n        } else {\r\n          material.color = new THREE.Color(\r\n            obj.material.color[0] / 255,\r\n            obj.material.color[1] / 255,\r\n            obj.material.color[2] / 255\r\n          );\r\n        }\r\n\r\n        const mesh = new THREE.Mesh(geometry, material);\r\n        mesh.position.copy(center);\r\n        mesh.userData.id = obj.id;\r\n        mesh.userData.layer = obj.layer;\r\n        mesh.castShadow = true;\r\n        mesh.receiveShadow = true;\r\n\r\n        scene.add(mesh);\r\n        meshesRef.current.push(mesh);\r\n      }\r\n    });\r\n  };\r\n\r\n  // 加载和更新模型\r\n  useEffect(() => {\r\n    if (!sceneRef.current || !buildingData) return;\r\n\r\n    const scene = sceneRef.current;\r\n    \r\n    // 清除现有对象\r\n    scene.children = scene.children.filter(child => \r\n      child.type === 'GridHelper' || \r\n      child.type === 'TransformControls' || \r\n      child.type === 'DirectionalLight' || \r\n      child.type === 'AmbientLight'\r\n    );\r\n\r\n    // 创建材质\r\n    const materials = {\r\n      wall: new THREE.MeshStandardMaterial({\r\n        color: 0xcccccc,\r\n        side: THREE.DoubleSide\r\n      }),\r\n      floor: new THREE.MeshStandardMaterial({\r\n        color: 0xeeeeee,\r\n        side: THREE.DoubleSide\r\n      }),\r\n      ceiling: new THREE.MeshStandardMaterial({\r\n        color: 0xdddddd,\r\n        side: THREE.DoubleSide\r\n      })\r\n    };\r\n\r\n    // 创建房间布局\r\n    const createRoom = (position, size, type) => {\r\n      const { width, depth, height } = size;\r\n      const { x, y, z } = position;\r\n\r\n      // 创建地板\r\n      const floorGeometry = new THREE.BoxGeometry(width, 1, depth);\r\n      const floor = new THREE.Mesh(floorGeometry, materials.floor);\r\n      floor.position.set(x, y, z);\r\n      floor.receiveShadow = true;\r\n      scene.add(floor);\r\n\r\n      // 创建天花板\r\n      const ceilingGeometry = new THREE.BoxGeometry(width, 1, depth);\r\n      const ceiling = new THREE.Mesh(ceilingGeometry, materials.ceiling);\r\n      ceiling.position.set(x, y + height, z);\r\n      ceiling.castShadow = true;\r\n      scene.add(ceiling);\r\n\r\n      // 创建墙体\r\n      const wallThickness = 20;\r\n      const wallHeight = height;\r\n\r\n      // 前墙\r\n      const frontWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);\r\n      const frontWall = new THREE.Mesh(frontWallGeometry, materials.wall);\r\n      frontWall.position.set(x, y + wallHeight/2, z + depth/2);\r\n      frontWall.castShadow = true;\r\n      frontWall.receiveShadow = true;\r\n      scene.add(frontWall);\r\n\r\n      // 后墙\r\n      const backWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);\r\n      const backWall = new THREE.Mesh(backWallGeometry, materials.wall);\r\n      backWall.position.set(x, y + wallHeight/2, z - depth/2);\r\n      backWall.castShadow = true;\r\n      backWall.receiveShadow = true;\r\n      scene.add(backWall);\r\n\r\n      // 左墙\r\n      const leftWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);\r\n      const leftWall = new THREE.Mesh(leftWallGeometry, materials.wall);\r\n      leftWall.position.set(x - width/2, y + wallHeight/2, z);\r\n      leftWall.castShadow = true;\r\n      leftWall.receiveShadow = true;\r\n      scene.add(leftWall);\r\n\r\n      // 右墙\r\n      const rightWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);\r\n      const rightWall = new THREE.Mesh(rightWallGeometry, materials.wall);\r\n      rightWall.position.set(x + width/2, y + wallHeight/2, z);\r\n      rightWall.castShadow = true;\r\n      rightWall.receiveShadow = true;\r\n      scene.add(rightWall);\r\n\r\n      // 为每个墙体添加用户数据\r\n      [floor, ceiling, frontWall, backWall, leftWall, rightWall].forEach(wall => {\r\n        wall.userData = {\r\n          id: `${type}-${Math.random().toString(36).substr(2, 9)}`,\r\n          type: type,\r\n          layer: 1\r\n        };\r\n      });\r\n    };\r\n\r\n    // 根据buildingData创建房间\r\n    const standardRoomHeight = 3000; // 标准房间高度\r\n    const standardRoomWidth = 6000;  // 标准房间宽度\r\n    const standardRoomDepth = 4000;  // 标准房间深度\r\n    const corridorWidth = 1500;      // 走廊宽度\r\n    const wallThickness = 150;       // 墙体厚度\r\n\r\n    // 创建客厅\r\n    createRoom(\r\n      { x: 0, y: 0, z: 0 },\r\n      { width: standardRoomWidth * 2, depth: standardRoomDepth * 2, height: standardRoomHeight },\r\n      'living-room'\r\n    );\r\n\r\n    // 根据卧室数量创建卧室\r\n    const bedroomCount = buildingData.properties.bedrooms;\r\n    if (bedroomCount > 0) {\r\n      // 计算卧室布局\r\n      const bedroomsPerRow = Math.ceil(bedroomCount / 2);\r\n      const totalWidth = (standardRoomWidth * bedroomsPerRow) + \r\n                        (corridorWidth * (bedroomsPerRow - 1)) + \r\n                        (wallThickness * bedroomsPerRow);\r\n\r\n      // 创建卧室\r\n      for (let i = 0; i < bedroomCount; i++) {\r\n        const row = Math.floor(i / 2);\r\n        const col = i % 2;\r\n        const x = (col === 0 ? -totalWidth/2 : totalWidth/2) + \r\n                 (col === 0 ? standardRoomWidth/2 : -standardRoomWidth/2);\r\n        const z = (row * (standardRoomDepth + corridorWidth + wallThickness)) - \r\n                 (standardRoomDepth * (bedroomsPerRow - 1) / 2);\r\n\r\n        createRoom(\r\n          { x, y: 0, z },\r\n          { width: standardRoomWidth, depth: standardRoomDepth, height: standardRoomHeight },\r\n          'bedroom'\r\n        );\r\n      }\r\n    }\r\n  }, [buildingData]);\r\n\r\n  // 监听 buildingData 变化\r\n  useEffect(() => {\r\n    if (buildingData) {\r\n      updateModel(buildingData);\r\n    }\r\n  }, [buildingData]);\r\n\r\n  useEffect(() => {\r\n    if (!containerRef.current) return;\r\n\r\n    // 初始化场景\r\n    const scene = new THREE.Scene();\r\n    scene.background = new THREE.Color(0xf0f0f0);\r\n    sceneRef.current = scene;\r\n\r\n    // 初始化相机\r\n    const camera = new THREE.PerspectiveCamera(\r\n      75,\r\n      window.innerWidth * 0.8 / window.innerHeight,\r\n      0.1,\r\n      50000\r\n    );\r\n    camera.position.set(15000, 15000, 15000);\r\n    camera.lookAt(0, 0, 0);\r\n    cameraRef.current = camera;\r\n\r\n    // 初始化渲染器\r\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n    renderer.setSize(window.innerWidth * 0.8, window.innerHeight);\r\n    renderer.shadowMap.enabled = true;\r\n    containerRef.current.appendChild(renderer.domElement);\r\n    rendererRef.current = renderer;\r\n\r\n    // 添加光源\r\n    const ambientLight = new THREE.AmbientLight(0x404040, 2);\r\n    scene.add(ambientLight);\r\n\r\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 2);\r\n    directionalLight.position.set(10000, 20000, 10000);\r\n    scene.add(directionalLight);\r\n\r\n    // 添加网格\r\n    const gridHelper = new THREE.GridHelper(30000, 30);\r\n    scene.add(gridHelper);\r\n\r\n    // 初始化控制器\r\n    const controls = new OrbitControls(camera, renderer.domElement);\r\n    controls.mouseButtons = {\r\n      LEFT: null,\r\n      MIDDLE: null,\r\n      RIGHT: THREE.MOUSE.ROTATE\r\n    };\r\n    controls.enablePan = true;\r\n    controls.enableZoom = true;\r\n    controls.panButton = THREE.MOUSE.MIDDLE;\r\n    controlsRef.current = controls;\r\n\r\n    // 初始化变换控制器\r\n    const transformControls = new TransformControls(camera, renderer.domElement);\r\n    transformControls.setSize(1);\r\n    transformControls.setTranslationSnap(100);\r\n    transformControls.setRotationSnap(THREE.MathUtils.degToRad(15));\r\n    transformControls.setScaleSnap(0.1);\r\n    scene.add(transformControls);\r\n    transformControlsRef.current = transformControls;\r\n\r\n    // 加载初始模型\r\n    fetch('/building.json')\r\n      .then(response => response.json())\r\n      .then(jsonModel => {\r\n        updateBuildingData(jsonModel);\r\n      })\r\n      .catch(error => console.error('Error loading model:', error));\r\n\r\n    // 动画循环\r\n    const animate = () => {\r\n      requestAnimationFrame(animate);\r\n      controls.update();\r\n      renderer.render(scene, camera);\r\n    };\r\n    animate();\r\n\r\n    // 窗口大小调整\r\n    const handleResize = () => {\r\n      if (!camera || !renderer) return;\r\n      camera.aspect = window.innerWidth * 0.8 / window.innerHeight;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(window.innerWidth * 0.8, window.innerHeight);\r\n    };\r\n    window.addEventListener('resize', handleResize);\r\n\r\n    // 清理函数\r\n    const container = containerRef.current;\r\n    return () => {\r\n      window.removeEventListener('resize', handleResize);\r\n      if (container) {\r\n        container.removeChild(renderer.domElement);\r\n      }\r\n      renderer.dispose();\r\n    };\r\n  }, [updateBuildingData]);\r\n\r\n  // 添加键盘快捷键支持\r\n  useEffect(() => {\r\n    const handleKeyDown = (event) => {\r\n      if (!selectedObjectRef.current || !transformControlsRef.current) return;\r\n      \r\n      switch (event.key.toLowerCase()) {\r\n        case 'g':\r\n          transformControlsRef.current.setMode('translate');\r\n          break;\r\n        case 'r':\r\n          transformControlsRef.current.setMode('rotate');\r\n          break;\r\n        case 's':\r\n          transformControlsRef.current.setMode('scale');\r\n          break;\r\n        case 'escape':\r\n          if (selectedObjectRef.current) {\r\n            selectedObjectRef.current.material.emissive.setHex(0x000000);\r\n            selectedObjectRef.current = null;\r\n            transformControlsRef.current.detach();\r\n          }\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, []);\r\n\r\n  return (\r\n    <div \r\n      ref={containerRef} \r\n      className=\"w-full h-full\"\r\n      onMouseDown={(e) => {\r\n        if (e.button === 0) { // 左键点击\r\n          const raycaster = new THREE.Raycaster();\r\n          const mouse = new THREE.Vector2();\r\n          const rect = rendererRef.current.domElement.getBoundingClientRect();\r\n          \r\n          mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;\r\n          mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;\r\n          \r\n          raycaster.setFromCamera(mouse, cameraRef.current);\r\n          const intersects = raycaster.intersectObjects(meshesRef.current);\r\n          \r\n          if (intersects.length > 0) {\r\n            const object = intersects[0].object;\r\n            if (selectedObjectRef.current !== object) {\r\n              if (selectedObjectRef.current) {\r\n                selectedObjectRef.current.material.emissive.setHex(0x000000);\r\n              }\r\n              selectedObjectRef.current = object;\r\n              object.material.emissive.setHex(0x333333);\r\n              transformControlsRef.current.attach(object);\r\n            }\r\n          } else {\r\n            if (selectedObjectRef.current) {\r\n              selectedObjectRef.current.material.emissive.setHex(0x000000);\r\n              selectedObjectRef.current = null;\r\n              transformControlsRef.current.detach();\r\n            }\r\n          }\r\n        }\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default DesignStudio; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}